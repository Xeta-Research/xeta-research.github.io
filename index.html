<title>Text Editor</title><link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMyAzIDE4IDE4Ij4KCTxzdHlsZT4KCQlAbWVkaWEocHJlZmVycy1jb2xvci1zY2hlbWU6bGlnaHQpeyp7Y29sb3Itc2NoZW1lOmxpZ2h0O319CgkJQG1lZGlhKHByZWZlcnMtY29sb3Itc2NoZW1lOmRhcmspeyp7Y29sb3Itc2NoZW1lOmRhcms7fX0KCTwvc3R5bGU+Cgk8cGF0aCBmaWxsPSJub25lIiBkPSJNMCAwaDI0djI0SDBWMHoiLz4KCTxwYXRoIGZpbGw9ImxpZ2h0LWRhcmsoYmxhY2ssd2hpdGUpIiBkPSJtMjAuNDEgNC45NC0xLjM1LTEuMzVjLS43OC0uNzgtMi4wNS0uNzgtMi44MyAwTDEzLjQgNi40MSAzIDE2LjgyVjIxaDQuMThsMTAuNDYtMTAuNDYgMi43Ny0yLjc3Yy43OS0uNzguNzktMi4wNSAwLTIuODN6bS0xNCAxNC4xMkw1IDE5di0xLjM2bDkuODItOS44MiAxLjQxIDEuNDEtOS44MiA5LjgzeiIvPgo8L3N2Zz4=">
<script>
	let input = async(event)=>{try{
		let modifiers = [
			(event.metaKey)?0b1000:0,
			(event.ctrlKey)?0b0100:0,
			(event.altKey)?0b0010:0,
			(event.shiftKey)?0b0001:0,
		].reduce((a,b)=>a+b);
		let {code,repeat,target} = event;
		if ([0b0000,0b0001].includes(modifiers) && code==='Tab'){event.preventDefault();
			let pos = [target.selectionStart,target.selectionEnd];
			let before = target.value.slice(0,pos[0]);
			let after = target.value.slice(pos[1]);
			target.value = before+'\t'+after;
			target.setSelectionRange(pos[0]+1,pos[0]+1);
		};
		if ([0b0000,0b0001].includes(modifiers) && code==='Enter'){event.preventDefault();
			let pos = [target.selectionStart,target.selectionEnd];
			let before = target.value.slice(0,pos[0]);
			let after = target.value.slice(pos[1]);
			let prevLine = before.split('\n').at(-1);
			let indent = (prevLine.match(/^\t{0,}/g)??[])[0];
			target.value = before+'\n'+indent+after;
			target.setSelectionRange(pos[0]+1+indent.length,pos[0]+1+indent.length);
		};
		if ([0b0010].includes(modifiers) && code==='KeyD'){event.preventDefault();
			textarea.value = await new Promise(resolve=>{
				let reader = new FileReader();
				reader.onload=()=>resolve(reader.result);
				reader.readAsDataURL(new Blob([textarea.value]));
			});
		};
		if ([0b0010].includes(modifiers) && code==='KeyF'){event.preventDefault();
			let response;
			try{response = await fetch(textarea.value)}catch(e){return alert(e)};
			textarea.value = await response.text();
		};
		if ([0b0010].includes(modifiers) && code==='KeyI'){event.preventDefault();
			try{await import(textarea.value)}catch(e){return alert(e)};
		};
		if ([0b0010].includes(modifiers) && code==='KeyO'){event.preventDefault();
			let file = await new Promise(resolve=>{
				let input = document.createElement('input');
				input.type='file';
				input.onchange=()=>resolve(input.files[0]);
				input.showPicker();
			});
			if (file.type.startsWith('text/')){target.value=await file.text()}
			else {
				let url = await new Promise(resolve=>{
					let reader = new FileReader();
					reader.onload=()=>resolve(reader.result);
					reader.readAsDataURL(file);
				});
				target.value = url;
			};
		};
		if ([0b0010].includes(modifiers) && code==='KeyR'){event.preventDefault();
			let url = URL.createObjectURL(new Blob([target.value],{type:'text/javascript'}));
			try{await import(url)}catch(e){alert(e?.stack??e)};
			URL.revokeObjectURL(url)
		};
		if ([0b0010].includes(modifiers) && code==='KeyS'){event.preventDefault();
			let blob = new Blob([target.value],{type:'application/octet-stream'});
			let link = document.createElement('a');
			link.download='file';
			link.href=URL.createObjectURL(blob);
			link.click();
			URL.revokeObjectURL(link.href);
		};
		if ([0b0010].includes(modifiers) && code==='KeyT'){event.preventDefault();
			if (!('stylize' in window)){await import('data:text/javascript;base64,d2luZG93LnN0eWxpemUgPSBzdHJpbmc9PnsKCS8vVGhlIGZpcnN0IGNvZGUgcG9pbnQgZm9yIGV2ZXJ5IGZvbnQKCWxldCBmb250UG9pbnRzPXsKCQlzZXJpZjp7CgkJCW5vcm1hbDp7CgkJCQl1cHBlcmNhc2U6MHg0MSwKCQkJCWxvd2VyY2FzZToweDYxLAoJCQkJZGlnaXRzOjB4MzAsCgkJCX0sCgkJCWJvbGQ6ewoJCQkJdXBwZXJjYXNlOjB4MWQ0MDAsCgkJCQlsb3dlcmNhc2U6MHgxZDQxYSwKCQkJCWRpZ2l0czoweDFkN2NlLAoJCQl9LAoJCQlpdGFsaWM6ewoJCQkJdXBwZXJjYXNlOjB4MWQ0MzQsCgkJCQlsb3dlcmNhc2U6MHgxZDQ0ZSwKCQkJfSwKCQkJYm9sZEl0YWxpYzp7CgkJCQl1cHBlcmNhc2U6MHgxZDQ2OCwKCQkJCWxvd2VyY2FzZToweDFkNDgyLAoJCQl9LAoJCX0sCgkJc2Fuc1NlcmlmOnsKCQkJbm9ybWFsOnsKCQkJCXVwcGVyY2FzZToweDFkNWEwLAoJCQkJbG93ZXJjYXNlOjB4MWQ1YmEsCgkJCQlkaWdpdHM6MHgxZDdlMiwKCQkJfSwKCQkJYm9sZDp7CgkJCQl1cHBlcmNhc2U6MHgxZDVkNCwKCQkJCWxvd2VyY2FzZToweDFkNWVlLAoJCQkJZGlnaXRzOjB4MWQ3ZWMsCgkJCX0sCgkJCWl0YWxpYzp7CgkJCQl1cHBlcmNhc2U6MHgxZDYwOCwKCQkJCWxvd2VyY2FzZToweDFkNjIyLAoJCQl9LAoJCQlib2xkSXRhbGljOnsKCQkJCXVwcGVyY2FzZToweDFkNjNjLAoJCQkJbG93ZXJjYXNlOjB4MWQ2NTYsCgkJCX0sCgkJfSwKCQlzY3JpcHQ6ewoJCQlub3JtYWw6ewoJCQkJdXBwZXJjYXNlOjB4MWQ0OWMsCgkJCQlsb3dlcmNhc2U6MHgxZDRiNiwKCQkJfSwKCQkJYm9sZDp7CgkJCQl1cHBlcmNhc2U6MHgxZDRkMCwKCQkJCWxvd2VyY2FzZToweDFkNGVhLAoJCQl9LAoJCX0sCgkJZnJha3R1cjp7CgkJCW5vcm1hbDp7CgkJCQl1cHBlcmNhc2U6MHgxZDUwNCwKCQkJCWxvd2VyY2FzZToweDFkNTFlLAoJCQl9LAoJCQlib2xkOnsKCQkJCXVwcGVyY2FzZToweDFkNTZjLAoJCQkJbG93ZXJjYXNlOjB4MWQ1ODYsCgkJCX0sCgkJfSwKCQltb25vc3BhY2U6ewoJCQl1cHBlcmNhc2U6MHgxZDY3MCwKCQkJbG93ZXJjYXNlOjB4MWQ2OGEsCgkJCWRpZ2l0czoweDFkN2Y2LAoJCX0sCgkJZG91YmxlU3RydWNrOnsKCQkJdXBwZXJjYXNlOjB4MWQ1MzgsCgkJCWxvd2VyY2FzZToweDFkNTUyLAoJCQlkaWdpdHM6MHgxZDdkOCwKCQl9LAoJfTsKCQoJLy9Gb250cwoJbGV0IHBvaW50ID0gbj0+U3RyaW5nLmZyb21Db2RlUG9pbnQobik7CglsZXQgVlMgPSAocyk9PnBvaW50KDB4RkUwMCsocy0xKSk7CglsZXQgWldTUCA9IHBvaW50KDB4MjAwQik7CglsZXQgWldOSiA9IHBvaW50KDB4MjAwQyk7CglsZXQgWldKID0gcG9pbnQoMHgyMDBEKTsKCWxldCByYW5nZSA9IChtaW4sbWF4KT0+ewoJCWxldCBjaGFycyA9IFtdOwoJCWZvciAobGV0IG49bWluO248PW1heDtuKyspewoJCQljaGFycy5wdXNoKHBvaW50KG4pKQoJCX07CgkJcmV0dXJuIGNoYXJzOwoJfTsKCWxldCBnZW5Gb250ID0gb2JqZWN0PT57CgkJbGV0IGJsb2NrID0gWy4uLnJhbmdlKDB4MDAsMHgyRildOwoJCWlmIChvYmplY3QuZGlnaXRzKXtibG9jay5wdXNoKC4uLnJhbmdlKG9iamVjdC5kaWdpdHMsb2JqZWN0LmRpZ2l0cysweDA5KSl9CgkJZWxzZSB7YmxvY2sucHVzaCguLi5yYW5nZSgweDMwLDB4MzkpKX07CgkJYmxvY2sucHVzaCguLi5yYW5nZSgweDNBLDB4NDApKTsKCQlibG9jay5wdXNoKC4uLnJhbmdlKG9iamVjdC51cHBlcmNhc2Usb2JqZWN0LnVwcGVyY2FzZSsweDE5KSk7CgkJYmxvY2sucHVzaCguLi5yYW5nZSgweDVCLDB4NjApKTsKCQlibG9jay5wdXNoKC4uLnJhbmdlKG9iamVjdC5sb3dlcmNhc2Usb2JqZWN0Lmxvd2VyY2FzZSsweDE5KSk7CgkJYmxvY2sucHVzaCguLi5yYW5nZSgweDdCLDB4N0YpKTsKCQlyZXR1cm4gYmxvY2s7Cgl9OwoJCglsZXQgZm9udHM9ewoJCXNlcmlmOnsKCQkJbm9ybWFsOmdlbkZvbnQoZm9udFBvaW50cy5zZXJpZi5ub3JtYWwpLAoJCQlib2xkOmdlbkZvbnQoZm9udFBvaW50cy5zZXJpZi5ib2xkKSwKCQkJaXRhbGljOmdlbkZvbnQoZm9udFBvaW50cy5zZXJpZi5pdGFsaWMpLAoJCQlib2xkSXRhbGljOmdlbkZvbnQoZm9udFBvaW50cy5zZXJpZi5ib2xkSXRhbGljKSwKCQl9LAoJCXNhbnNTZXJpZjp7CgkJCW5vcm1hbDpnZW5Gb250KGZvbnRQb2ludHMuc2Fuc1NlcmlmLm5vcm1hbCksCgkJCWJvbGQ6Z2VuRm9udChmb250UG9pbnRzLnNhbnNTZXJpZi5ib2xkKSwKCQkJaXRhbGljOmdlbkZvbnQoZm9udFBvaW50cy5zYW5zU2VyaWYuaXRhbGljKSwKCQkJYm9sZEl0YWxpYzpnZW5Gb250KGZvbnRQb2ludHMuc2Fuc1NlcmlmLmJvbGRJdGFsaWMpLAoJCX0sCgkJc2NyaXB0OnsKCQkJbm9ybWFsOmdlbkZvbnQoZm9udFBvaW50cy5zY3JpcHQubm9ybWFsKSwKCQkJYm9sZDpnZW5Gb250KGZvbnRQb2ludHMuc2NyaXB0LmJvbGQpLAoJCX0sCgkJZnJha3R1cjp7CgkJCW5vcm1hbDpnZW5Gb250KGZvbnRQb2ludHMuZnJha3R1ci5ub3JtYWwpLAoJCQlib2xkOmdlbkZvbnQoZm9udFBvaW50cy5mcmFrdHVyLmJvbGQpLAoJCX0sCgkJbW9ub3NwYWNlOmdlbkZvbnQoZm9udFBvaW50cy5tb25vc3BhY2UpLAoJCWRvdWJsZVN0cnVjazpnZW5Gb250KGZvbnRQb2ludHMuZG91YmxlU3RydWNrKSwKCQlmdWxsd2lkdGg6WwoJCQlyYW5nZSgweDAwLDB4MUYpLAoJCQlwb2ludCgweDIwMDMpLAoJCQlwb2ludCgweEZGMDEpK1ZTKDIpLAoJCQlyYW5nZSgweEZGMDIsMHhGRjA3KSwKCQkJcG9pbnQoMHhGRjA4KStWUygyKSwKCQkJcG9pbnQoMHhGRjA5KStWUygyKSwKCQkJcmFuZ2UoMHhGRjBBLDB4RkYwQiksCgkJCXBvaW50KDB4RkYwQykrVlMoMiksCgkJCXBvaW50KDB4RkYwRCksCgkJCXBvaW50KDB4RkYwRSkrVlMoMiksCgkJCXJhbmdlKDB4RkYwRiwweEZGMTkpLAoJCQlwb2ludCgweEZGMUEpK1ZTKDIpLAoJCQlwb2ludCgweEZGMUIpK1ZTKDIpLAoJCQlyYW5nZSgweEZGMUMsMHhGRjFFKSwKCQkJcG9pbnQoMHhGRjFGKStWUygyKSwKCQkJcmFuZ2UoMHhGRjIwLDB4RkYzQSksCgkJCXBvaW50KDB4RkYzQikrVlMoMiksCgkJCXBvaW50KDB4RkYzQyksCgkJCXBvaW50KDB4RkYzRCkrVlMoMiksCgkJCXJhbmdlKDB4RkYzRSwweEZGNUEpLAoJCQlwb2ludCgweEZGNUIpK1ZTKDIpLAoJCQlwb2ludCgweEZGNUMpLAoJCQlwb2ludCgweEZGNUQpK1ZTKDIpLAoJCQlwb2ludCgweEZGNUUpLAoJCQlwb2ludCgweDdGKQoJCV0uZmxhdChJbmZpbml0eSksCgkJZW5jbG9zZWQ6ewoJCQljaXJjbGU6WwoJCQkJcmFuZ2UoMHgwMCwweDJGKSwKCQkJCXBvaW50KDB4MjRFQSkscmFuZ2UoMHgyNDYwLDB4MjQ2OCksCgkJCQlyYW5nZSgweDNBLDB4NDApLAoJCQkJcmFuZ2UoMHgyNEI2LDB4MjRDRiksCgkJCQlyYW5nZSgweDVCLDB4NjApLAoJCQkJcmFuZ2UoMHgyNEQwLDB4MjRFOSksCgkJCQlyYW5nZSgweDdCLDB4N0YpCgkJCV0uZmxhdChJbmZpbml0eSksCgkJCWNpcmNsZUFsbDpbCgkJCQlyYW5nZSgweDAwLDB4MjApLAoJCQkJcmFuZ2UoMHgyMSwweDJGKS5tYXAoY2hhcj0+Y2hhcitwb2ludCgweDIwREQpKSwKCQkJCXBvaW50KDB4MjRFQSkscmFuZ2UoMHgyNDYwLDB4MjQ2OCksCgkJCQlyYW5nZSgweDNBLDB4NDApLm1hcChjaGFyPT5jaGFyK3BvaW50KDB4MjBERCkpLAoJCQkJcmFuZ2UoMHgyNEI2LDB4MjRDRiksCgkJCQlyYW5nZSgweDVCLDB4NjApLm1hcChjaGFyPT5jaGFyK3BvaW50KDB4MjBERCkpLAoJCQkJcmFuZ2UoMHgyNEQwLDB4MjRFOSksCgkJCQlyYW5nZSgweDdCLDB4N0UpLm1hcChjaGFyPT5jaGFyK3BvaW50KDB4MjBERCkpLAoJCQkJcG9pbnQoMHg3RikKCQkJXS5mbGF0KEluZmluaXR5KSwKCQkJY2lyY2xlRmlsbDpbCgkJCQlyYW5nZSgweDAwLDB4MkYpLAoJCQkJcG9pbnQoMHgyNEZGKSwKCQkJCXJhbmdlKDB4MzEsMHg0MCksCgkJCQlyYW5nZSgweDFGMTUwLDB4MUYxNjkpLAoJCQkJcmFuZ2UoMHg1QiwweDdGKQoJCQldLmZsYXQoSW5maW5pdHkpLAoJCQlzcXVhcmU6WwoJCQkJcmFuZ2UoMHgwMCwweDQwKSwKCQkJCXJhbmdlKDB4MUYxMzAsMHgxRjE0OSksCgkJCQlyYW5nZSgweDVCLDB4N0YpCgkJCV0uZmxhdChJbmZpbml0eSksCgkJCXNxdWFyZUFsbDpbCgkJCQlyYW5nZSgweDAwLDB4MjApLAoJCQkJcmFuZ2UoMHgyMSwweDQwKS5tYXAoY2hhcj0+Y2hhcitwb2ludCgweDIwREUpKSwKCQkJCXJhbmdlKDB4MUYxMzAsMHgxRjE0OSksCgkJCQlyYW5nZSgweDVCLDB4N0UpLm1hcChjaGFyPT5jaGFyK3BvaW50KDB4MjBERSkpLAoJCQkJcG9pbnQoMHg3RikKCQkJXS5mbGF0KEluZmluaXR5KSwKCQkJc3F1YXJlRmlsbDpbCgkJCQlyYW5nZSgweDAwLDB4NDApLAoJCQkJcmFuZ2UoMHgxRjE3MCwweDFGMTg5KSwKCQkJCXJhbmdlKDB4NUIsMHg3RikKCQkJXS5mbGF0KEluZmluaXR5KSwKCQkJZGlhbW9uZDpbCgkJCQlyYW5nZSgweDAwLDB4MkYpLAoJCQkJcmFuZ2UoMHgzMCwweDM5KS5tYXAoY2hhcj0+Y2hhcitwb2ludCgweDIwREYpKSwKCQkJCXJhbmdlKDB4M0EsMHg0MCksCgkJCQlyYW5nZSgweDQxLDB4NUEpLm1hcChjaGFyPT5jaGFyK3BvaW50KDB4MjBERikpLAoJCQkJcmFuZ2UoMHg1QiwweDYwKSwKCQkJCXJhbmdlKDB4NjEsMHg3QSkubWFwKGNoYXI9PmNoYXIrcG9pbnQoMHgyMERGKSksCgkJCQlyYW5nZSgweDdCLDB4N0YpCgkJCV0uZmxhdChJbmZpbml0eSksCgkJCWRlbnk6WwoJCQkJcmFuZ2UoMHgwMCwweDJGKSwKCQkJCXJhbmdlKDB4MzAsMHgzOSkubWFwKGNoYXI9PmNoYXIrcG9pbnQoMHgyMEUwKSksCgkJCQlyYW5nZSgweDNBLDB4NDApLAoJCQkJcmFuZ2UoMHg0MSwweDVBKS5tYXAoY2hhcj0+Y2hhcitwb2ludCgweDIwRTApKSwKCQkJCXJhbmdlKDB4NUIsMHg2MCksCgkJCQlyYW5nZSgweDYxLDB4N0EpLm1hcChjaGFyPT5jaGFyK3BvaW50KDB4MjBFMCkpLAoJCQkJcmFuZ2UoMHg3QiwweDdGKQoJCQldLmZsYXQoSW5maW5pdHkpLAoJCQlzY3JlZW46WwoJCQkJcmFuZ2UoMHgwMCwweDJGKSwKCQkJCXJhbmdlKDB4MzAsMHgzOSkubWFwKGNoYXI9PmNoYXIrcG9pbnQoMHgyMEUyKSksCgkJCQlyYW5nZSgweDNBLDB4NDApLAoJCQkJcmFuZ2UoMHg0MSwweDVBKS5tYXAoY2hhcj0+Y2hhcitwb2ludCgweDIwRTIpKSwKCQkJCXJhbmdlKDB4NUIsMHg2MCksCgkJCQlyYW5nZSgweDYxLDB4N0EpLm1hcChjaGFyPT5jaGFyK3BvaW50KDB4MjBFMikpLAoJCQkJcmFuZ2UoMHg3QiwweDdGKQoJCQldLmZsYXQoSW5maW5pdHkpLAoJCQlrZXljYXA6WwoJCQkJcmFuZ2UoMHgwMCwweDFGKSwKCQkJCXJhbmdlKDB4MjAsMHg3RSkubWFwKGNoYXI9PmNoYXIrcG9pbnQoMHgyMEUzKSksCgkJCQlwb2ludCgweDdGKQoJCQldLmZsYXQoSW5maW5pdHkpLAoJCQl0cmlhbmdsZTpbCgkJCQlyYW5nZSgweDAwLDB4MkYpLAoJCQkJcmFuZ2UoMHgzMCwweDM5KS5tYXAoY2hhcj0+Y2hhcitwb2ludCgweDIwRTQpKSwKCQkJCXJhbmdlKDB4M0EsMHg0MCksCgkJCQlyYW5nZSgweDQxLDB4NUEpLm1hcChjaGFyPT5jaGFyK3BvaW50KDB4MjBFNCkpLAoJCQkJcmFuZ2UoMHg1QiwweDYwKSwKCQkJCXJhbmdlKDB4NjEsMHg3QSkubWFwKGNoYXI9PmNoYXIrcG9pbnQoMHgyMEU0KSksCgkJCQlyYW5nZSgweDdCLDB4N0YpCgkJCV0uZmxhdChJbmZpbml0eSksCgkJfSwKCQlmbGFnY29kZTpbCgkJCXJhbmdlKDB4MDAsMHg0MCksCgkJCXJhbmdlKDB4MUYxRTYsMHgxRjFGRiksCgkJCXJhbmdlKDB4NUIsMHg3RikKCQldLmZsYXQoSW5maW5pdHkpLAoJCXdpbmdkaW5nczpbCgkJCXJhbmdlKDB4MDAsMHgxRiksCgkJCXBvaW50KDB4MjAwMyksIC8vRU0gc3BhY2UKCQkJcG9pbnQoMHgxRjU4OSksIC8vcGVuY2lsCgkJCXBvaW50KDB4MjcwMiksIC8vc2Npc3NvcnMKCQkJcG9pbnQoMHgyNzAxKSwgLy9kb3dud2FyZCBzY2lzc29ycwoJCQlwb2ludCgweDFGNDUzKSwgLy9nbGFzc2VzCgkJCXBvaW50KDB4MUY1NkQpLCAvL2JlbGwKCQkJcG9pbnQoMHgxRjU2RSksIC8vYm9vawoJCQlwb2ludCgweDFGNTZGKSwgLy9jYW5kbGUKCQkJcG9pbnQoMHgxRjU3RiksIC8vcGhvbmUKCQkJcG9pbnQoMHgyNzA2KSwgLy9jaXJjbGVkIHBob25lIHJlY2VpdmVyCgkJCXBvaW50KDB4MUY1ODIpLCAvL2Nsb3NlZCBlbnZlbG9wZQoJCQlwb2ludCgweDFGNTgzKSwgLy9zdGFtcGVkIGVudmVsb3BlCgkJCXBvaW50KDB4MUY0RUEpLCAvL2Nsb3NlZCBtYWlsYm94IHdpdGggbG93ZXJlZCBmbGFnCgkJCXBvaW50KDB4MUY0RUIpLCAvL2Nsb3NlZCBtYWlsYm94IHdpdGggcmFpc2VkIGZsYWcKCQkJcG9pbnQoMHgxRjRFQyksIC8vb3BlbiBtYWlsYm94IHdpdGggcmFpc2VkIGZsYWcKCQkJcG9pbnQoMHgxRjRFRCksIC8vb3BlbiBtYWlsYm94IHdpdGggbG93ZXJlZCBmbGFnCgkJCXBvaW50KDB4MUY1QzApLCAvL2Nsb3NlZCBmb2xkZXIKCQkJcG9pbnQoMHgxRjVDMSksIC8vb3BlbiBmb2xkZXIKCQkJcG9pbnQoMHgxRjVDRSksIC8vZG9jdW1lbnQKCQkJcG9pbnQoMHgxRjVDRiksIC8vcGFnZQoJCQlwb2ludCgweDFGNUQwKSwgLy9wYWdlcwoJCQlwb2ludCgweDFGNUM0KSwgLy9maWxlIGNhYmluZXQKCQkJcG9pbnQoMHgyM0YzKSwgLy9ob3VyZ2xhc3MKCQkJcG9pbnQoMHgxRjVBRSksIC8va2V5Ym9hcmQKCQkJcG9pbnQoMHgxRjVCMCksIC8vbW91c2UKCQkJcG9pbnQoMHgxRjVCMiksIC8vdHJhY2tiYWxsCgkJCXBvaW50KDB4MUY1QjMpLCAvL29sZCBjb21wdXRlcgoJCQlwb2ludCgweDFGNUI0KSwgLy9oYXJkIGRpc2sKCQkJcG9pbnQoMHgxRjVBQiksIC8vaGFyZCBzaGVsbCBmbG9wcHkgZGlzawoJCQlwb2ludCgweDFGNUFDKSwgLy9zb2Z0IHNoZWxsIGZsb3BweSBkaXNrCgkJCXBvaW50KDB4MjcwNyksIC8vdGFwZSBkcml2ZQoJCQlwb2ludCgweDI3MEQpLCAvL3JpZ2h0IHdyaXRpbmcgaGFuZAoJCQlwb2ludCgweDFGNThFKSwgLy9sZWZ0IHdyaXRpbmcgaGFuZAoJCQlwb2ludCgweDI3MEMpLCAvL3ZpY3RvcnkgaGFuZAoJCQlwb2ludCgweDFGNThGKSwgLy90dXJuZWQgT0sgaGFuZAoJCQlwb2ludCgweDFGNDREKSwgLy90aHVtYnMgdXAKCQkJcG9pbnQoMHgxRjQ0RSksIC8vdGh1bWJzIGRvd24KCQkJcG9pbnQoMHgyNjFDKSwgLy9sZWZ0IHBvaW50aW5nIGhhbmQKCQkJcG9pbnQoMHgyNjFFKSwgLy9yaWdodCBwb2ludGluZyBoYW5kCgkJCXBvaW50KDB4MjYxRCksIC8vdXAgcG9pbnRpbmcgaGFuZAoJCQlwb2ludCgweDI2MUYpLCAvL2Rvd24gcG9pbnRpbmcgaGFuZAoJCQlwb2ludCgweDFGNTkwKSwgLy9yaWdodCBwYWxtIGhhbmQKCQkJcG9pbnQoMHgyNjNBKSwgLy9zbWlsaW5nIGZhY2UKCQkJcG9pbnQoMHgxRjYxMCksIC8vbmV1dHJhbCBmYWNlCgkJCXBvaW50KDB4MjYzOSksIC8vZnJvd25pbmcgZmFjZQoJCQlwb2ludCgweDFGNEEzKSwgLy9ib21iCgkJCXBvaW50KDB4MUY1NzEpLCAvL3NrdWxsIGFuZCBjcm9zc2JvbmVzCgkJCXBvaW50KDB4MjY5MCksIC8vd2hpdGUgZmxhZwoJCQlwb2ludCgweDFGM0YxKSwgLy90cmlhbmd1bGFyIGZsYWcKCQkJcG9pbnQoMHgxRjZFQSksIC8vbm9ydGhlYXN0IGFpcnBsYW5lIChjb3VsZG4ndCBmaW5kIGFuIGVhc3R3YXJkIG9uZSkKCQkJcG9pbnQoMHgyNjNDKSwgLy93aGl0ZSBzdW4KCQkJcG9pbnQoMHgxRjMyMiksIC8vZHJvcGxldAoJCQlwb2ludCgweDI3NDQpLCAvL3Nub3dmbGFrZQoJCQlwb2ludCgweDFGNTQ2KSwgLy93aGl0ZSBsYXRpbiBjcm9zcwoJCQlwb2ludCgweDI3MUUpLCAvL3doaXRlIGxhdGluIGNyb3NzIHdpdGggc2hhZG93CgkJCXBvaW50KDB4MUY1NDgpLCAvL2NlbHRpYyBjcm9zcwoJCQlwb2ludCgweDI3MjApLCAvL21hbHRlc2UgY3Jvc3MKCQkJcG9pbnQoMHgyNzIxKSwgLy9zdGFyIG9mIGRhdmlkCgkJCXBvaW50KDB4MjYyQSksIC8vc3RhciBhbmQgY3Jlc2NlbnQKCQkJcG9pbnQoMHgyNjJGKSwgLy95aW4teWFuZwoJCQlwb2ludCgweDk1MCksIC8vb20KCQkJcG9pbnQoMHgyNjM4KSwgLy93aGVlbCBvZiBkaGFybWEKCQkJcmFuZ2UoMHgyNjQ4LDB4MjY1MyksIC8vYXN0cm9sb2dpY2FsIHN5bWJvbHMKCQkJcG9pbnQoMHgxRjY3MCksIC8vbGlnYXR1cmUgZXQKCQkJcG9pbnQoMHgxRjY3NSksIC8vc3dhc2ggYW1wZXJzYW5kCgkJCXBvaW50KDB4MjVDRiksIC8vYmxhY2sgY2lyY2xlCgkJCXBvaW50KDB4Mjc0RCksIC8vd2hpdGUgY2lyY2xlIHdpdGggc2hhZG93CgkJCXBvaW50KDB4MjVBMCksIC8vYmxhY2sgc3F1YXJlCgkJCXBvaW50KDB4MjVBMSksIC8vd2hpdGUgc3F1YXJlIChWYXJpYW50cyAweDI1QTEsIDFGNzhGKQoJCQlwb2ludCgweDFGNzkwKSwgLy9ib2xkIHdoaXRlIHNxdWFyZQoJCQlwb2ludCgweDI3NTEpLCAvL3doaXRlIHNxdWFyZSB3aXRoIHNvdXRoZWFzdCBzaGFkb3cKCQkJcG9pbnQoMHgyNzUyKSwgLy93aGl0ZSBzcXVhcmUgd2l0aCBub3J0aGVhc3Qgc2hhZG93CgkJCXBvaW50KDB4MkIyNyksIC8vc21hbGwgYmxhY2sgbG96ZW5nZQoJCQlwb2ludCgweDI5RUIpLCAvL2xhcmdlIGJsYWNrIGxvemVuZ2UKCQkJcG9pbnQoMHgyNUM2KSwgLy9sYXJnZSBibGFjayBkaWFtb25kCgkJCXBvaW50KDB4Mjc1NiksIC8vbGFyZ2UgYmxhY2sgZGlhbW9uZCBtaW51cyB3aGl0ZSB4CgkJCXBvaW50KDB4MkIyNSksIC8vc21hbGwgYmxhY2sgZGlhbW9uZAoJCQlwb2ludCgweDIzMjcpLCAvL3ggaW4gcmVjdGFuZ2xlCgkJCXBvaW50KDB4MkJCOSksIC8vY2FyZXQgaW4gcmVjdGFuZ2xlCgkJCXBvaW50KDB4MjMxOCksIC8vc2FpbnQgaGFubmVzIGNyb3NzCgkJCXBvaW50KDB4MUYzRjUpLCAvL3doaXRlIHJvc2V0dGUKCQkJcG9pbnQoMHgxRjNGNiksIC8vYmxhY2sgcm9zZXR0ZQoJCQlwb2ludCgweDFGNjc2KSwgLy9sZWZ0IGRvdWJsZSBxdW90ZQoJCQlwb2ludCgweDFGNjc3KSwgLy9yaWdodCBkb3VibGUgcXVvdGUKCQkJcG9pbnQoMHg3RiksCgkJXS5mbGF0KEluZmluaXR5KS5tYXAoY2hhcj0+Y2hhcitWUygxNSkpLAoJfTsKCQoJLy9Db2RlIHBvaW50IGNvcnJlY3Rpb24gYmVjYXVzZSBzb21lIG9mIHRoZXNlIGNvZGVwb2ludHMgQVJFIFJFU0VSVkVEIEZPUiBTT01FUExBQ0UgRUxTRSBXSFlZWT8hCglsZXQgYWx0ZXJuYXRlcyA9IHsKCQkvL3NlcmlmIGl0YWxpYyBsb3dlcmNhc2UKCQlbMHgxZDQ0ZSsweDA3XToweDIxMGUsIC8vaAoJCQoJCS8vc2NyaXB0IG5vcm1hbCB1cHBlcmNhc2UKCQlbMHgxZDQ5YysweDAxXToweDIxMkMsIC8vQgoJCVsweDFkNDljKzB4MDRdOjB4MjEzMCwgLy9FCgkJWzB4MWQ0OWMrMHgwNV06MHgyMTMxLCAvL0YKCQlbMHgxZDQ5YysweDA3XToweDIxMEIsIC8vSAoJCVsweDFkNDljKzB4MDhdOjB4MjExMCwgLy9JCgkJWzB4MWQ0OWMrMHgwYl06MHgyMTEyLCAvL0wKCQlbMHgxZDQ5YysweDBjXToweDIxMzMsIC8vTQoJCVsweDFkNDljKzB4MTFdOjB4MjExYiwgLy9SCgkJCgkJLy9zY3JpcHQgbm9ybWFsIGxvd2VyY2FzZQoJCVsweDFkNGI2KzB4MDRdOjB4MjEyZiwgLy9lCgkJWzB4MWQ0YjYrMHgwNl06MHgyMTBhLCAvL2cKCQlbMHgxZDRiNisweDBlXToweDIxMzQsIC8vbwoJCQoJCS8vZnJha3R1ciBub3JtYWwgdXBwZXJjYXNlCgkJWzB4MWQ1MDQrMHgwMl06MHgyMTJkLCAvL0MKCQlbMHgxZDUwNCsweDA3XToweDIxMGMsIC8vSAoJCVsweDFkNTA0KzB4MDhdOjB4MjExMSwgLy9JCgkJWzB4MWQ1MDQrMHgxMV06MHgyMTFjLCAvL1IKCQlbMHgxZDUwNCsweDE5XToweDIxMjgsIC8vWgoJCQoJCS8vZG91YmxlIHN0cnVjayB1cHBlcmNhc2UKCQlbMHgxZDUzOCsweDAyXToweDIxMDIsIC8vQwoJCVsweDFkNTM4KzB4MDddOjB4MjEwZCwgLy9ICgkJWzB4MWQ1MzgrMHgwZF06MHgyMTE1LCAvL04KCQlbMHgxZDUzOCsweDBmXToweDIxMTksIC8vUAoJCVsweDFkNTM4KzB4MTBdOjB4MjExYSwgLy9RCgkJWzB4MWQ1MzgrMHgxMV06MHgyMTFkLCAvL1IKCQlbMHgxZDUzOCsweDE5XToweDIxMjQsIC8vWgoJfTsKCWxldCBjb3JyZWN0aW9uID0gKHN0cmluZyxyZXZlcnNlPWZhbHNlKT0+ewoJCWZvciAobGV0IGVudHJ5IG9mIE9iamVjdC5lbnRyaWVzKGFsdGVybmF0ZXMpKXsKCQkJaWYgKCFyZXZlcnNlKSB7c3RyaW5nPXN0cmluZy5yZXBsYWNlQWxsKFN0cmluZy5mcm9tQ29kZVBvaW50KGVudHJ5WzBdKSxTdHJpbmcuZnJvbUNvZGVQb2ludChlbnRyeVsxXSkpfQoJCQllbHNlIHtzdHJpbmc9c3RyaW5nLnJlcGxhY2VBbGwoU3RyaW5nLmZyb21Db2RlUG9pbnQoZW50cnlbMV0pLFN0cmluZy5mcm9tQ29kZVBvaW50KGVudHJ5WzBdKSl9OwkKCQl9OwoJCXJldHVybiBzdHJpbmc7Cgl9OwoJbGV0IG5vdmFyaWFudHMgPSAoc3RyaW5nKT0+ewoJCWZvciAobGV0IHY9MTt2PD0xNjt2KyspewoJCQlzdHJpbmc9c3RyaW5nLnJlcGxhY2UoVlModiksJycpOwoJCX07CgkJcmV0dXJuIHN0cmluZzsKCX07CgkKCS8vRm9udCBjb252ZXJ0ZXJzCglsZXQgcmVzZXQgPSBzdHJpbmc9PnsKCQkvL2NvZGUgcG9pbnQgY29ycmVjdGlvbnMKCQlzdHJpbmc9bm92YXJpYW50cyhzdHJpbmcpOwoJCXN0cmluZz1jb3JyZWN0aW9uKHN0cmluZyx0cnVlKTsKCQkKCQkvL3JldmVydCB0byBiYXNpYyBsYXRpbgoJCWxldCBiYXNpY0xhdGluPXJhbmdlKDB4MDAsMHg3Rik7CgkJbGV0IGFsbEZvbnRzPVsKCQkJZm9udHMuc2VyaWYubm9ybWFsLAoJCQlmb250cy5zZXJpZi5ib2xkLAoJCQlmb250cy5zZXJpZi5pdGFsaWMsCgkJCWZvbnRzLnNlcmlmLmJvbGRJdGFsaWMsCgkJCWZvbnRzLnNhbnNTZXJpZi5ub3JtYWwsCgkJCWZvbnRzLnNhbnNTZXJpZi5ib2xkLAoJCQlmb250cy5zYW5zU2VyaWYuaXRhbGljLAoJCQlmb250cy5zYW5zU2VyaWYuYm9sZEl0YWxpYywKCQkJZm9udHMuc2NyaXB0Lm5vcm1hbCwKCQkJZm9udHMuc2NyaXB0LmJvbGQsCgkJCWZvbnRzLmZyYWt0dXIubm9ybWFsLAoJCQlmb250cy5mcmFrdHVyLmJvbGQsCgkJCWZvbnRzLm1vbm9zcGFjZSwKCQkJZm9udHMuZG91YmxlU3RydWNrLAoJCQlmb250cy5mdWxsd2lkdGgsCgkJCWZvbnRzLmZ1bGx3aWR0aC5tYXAoY2hhcj0+Y2hhci5yZXBsYWNlQWxsKFZTKDIpLCcnKSksCgkJCWZvbnRzLmVuY2xvc2VkLmNpcmNsZSwKCQkJZm9udHMuZW5jbG9zZWQuY2lyY2xlQWxsLAoJCQlmb250cy5lbmNsb3NlZC5jaXJjbGVGaWxsLAoJCQlmb250cy5lbmNsb3NlZC5zcXVhcmUsCgkJCWZvbnRzLmVuY2xvc2VkLnNxdWFyZUFsbCwKCQkJZm9udHMuZW5jbG9zZWQuc3F1YXJlRmlsbCwKCQkJZm9udHMuZW5jbG9zZWQuZGlhbW9uZCwKCQkJZm9udHMuZW5jbG9zZWQuZGVueSwKCQkJZm9udHMuZW5jbG9zZWQuc2NyZWVuLAoJCQlmb250cy5lbmNsb3NlZC5rZXljYXAsCgkJCWZvbnRzLmVuY2xvc2VkLnRyaWFuZ2xlLAoJCQlmb250cy5mbGFnY29kZSwKCQkJZm9udHMud2luZ2RpbmdzLAoJCQlmb250cy53aW5nZGluZ3MubWFwKGNoYXI9PmNoYXIucmVwbGFjZUFsbChWUygxNSksJycpKSwKCQldOwoJCWZvciAobGV0IGluZGV4PTA7aW5kZXg8PTB4N0Y7aW5kZXgrKyl7CgkJCWZvciAobGV0IGZvbnQgb2YgYWxsRm9udHMpewoJCQkJc3RyaW5nPXN0cmluZy5yZXBsYWNlQWxsKGZvbnRbaW5kZXhdLGJhc2ljTGF0aW5baW5kZXhdKTsJCgkJCX07CgkJfTsKCQlyZXR1cm4gc3RyaW5nOwoJfTsKCQoJbGV0IGNvbnZlcnQgPSAoc3RyaW5nLGZvbnQpPT57CgkJbGV0IGJhc2ljTGF0aW49cmFuZ2UoMHgwMCwweDdGKTsKCQlmb3IgKGxldCBpbmRleD0wO2luZGV4PD0weDdGO2luZGV4KyspewoJCQlzdHJpbmc9c3RyaW5nLnJlcGxhY2VBbGwoYmFzaWNMYXRpbltpbmRleF0sZm9udFtpbmRleF0pOwoJCX07CgkJcmV0dXJuIGNvcnJlY3Rpb24oc3RyaW5nKTsKCX07CgkKCS8vVGV4dCByZXNldAoJc3RyaW5nPXJlc2V0KHN0cmluZyk7CgkKCS8vT3B0aW9uIHBpY2tlcgoJbGV0IGNob29zZT0obWVzc2FnZSxvcHRpb25zLHNob3dMaXN0PXRydWUpPT57CgkJb3B0aW9ucz1vcHRpb25zLm1hcChvcHRpb249Pm9wdGlvbi50cmltKCkpOwoJCWxldCBidWxsZXQgPSBwb2ludCgweDIwMjIpOwoJCWlmIChzaG93TGlzdCkgbWVzc2FnZSs9b3B0aW9ucy5tYXAob3B0aW9uPT5gXG4ke2J1bGxldH0gJHtvcHRpb259YCkuam9pbignJyk7CgkJb3B0aW9ucz1vcHRpb25zLm1hcChvcHRpb249Pm9wdGlvbi50b0xvd2VyQ2FzZSgpKTsKCQlsZXQgY2hvaWNlOwoJCXdoaWxlKHRydWUpewoJCQljaG9pY2U9cHJvbXB0KG1lc3NhZ2UpOwoJCQlpZiAoY2hvaWNlPT09bnVsbCkgcmV0dXJuIGZhbHNlOwoJCQljaG9pY2U9Y2hvaWNlLnRyaW0oKS50b0xvd2VyQ2FzZSgpOwoJCQlpZiAob3B0aW9ucy5pbmNsdWRlcyhjaG9pY2UpKXtyZXR1cm4gY2hvaWNlfTsKCQl9OwoJfTsKCQoJLy9Gb250IFNlbGVjdGlvbgoJbGV0IGZvbnQ7CglmYW1pbHlQaWNrZXI6d2hpbGUodHJ1ZSl7CgkJbGV0IGJ1bGxldCA9IHBvaW50KDB4MjAyMik7CgkJbGV0IGZhbWlseSA9IGNob29zZShbCgkJCWBDaG9vc2UgYSBmb250IGZhbWlseTpgLAoJCQlgJHtidWxsZXR9ICR7Y29udmVydCgnU2VyaWYnLGZvbnRzLnNlcmlmLm5vcm1hbCl9YCwKCQkJYCR7YnVsbGV0fSAke2NvbnZlcnQoJ1NhbnMgU2VyaWYnLGZvbnRzLnNhbnNTZXJpZi5ub3JtYWwpfWAsCgkJCWAke2J1bGxldH0gJHtjb252ZXJ0KCdNb25vc3BhY2UnLGZvbnRzLm1vbm9zcGFjZSl9YCwKCQkJYCR7YnVsbGV0fSAke2NvbnZlcnQoJ0Z1bGx3aWR0aCcsZm9udHMuZnVsbHdpZHRoKX1gLAoJCQlgJHtidWxsZXR9ICR7Y29udmVydCgnU2NyaXB0Jyxmb250cy5zY3JpcHQubm9ybWFsKX0gKFNjcmlwdClgLAoJCQlgJHtidWxsZXR9ICR7Y29udmVydCgnRnJha3R1cicsZm9udHMuZnJha3R1ci5ub3JtYWwpfSAoRnJha3R1cilgLAoJCQlgJHtidWxsZXR9ICR7Y29udmVydCgnRG91YmxlIFN0cnVjaycsZm9udHMuZG91YmxlU3RydWNrKX0gKERvdWJsZSBTdHJ1Y2spYCwKCQkJYCR7YnVsbGV0fSAke2NvbnZlcnQoJ0VuY2xvc2VkJyxmb250cy5lbmNsb3NlZC5jaXJjbGUpfWAsCgkJCWAke2J1bGxldH0gJHtjb252ZXJ0KGBGTCR7WldTUH1BRyR7WldTUH1DTyR7WldTUH1ERWAsZm9udHMuZmxhZ2NvZGUpfSAoRmxhZ2NvZGUpYCwKCQkJYCR7YnVsbGV0fSAke2NvbnZlcnQoJ1dpbmdkaW5ncycsZm9udHMud2luZ2RpbmdzKX0gKFdpbmdkaW5ncylgLAoJCV0uZmlsdGVyKGl0ZW09Pml0ZW0hPT1udWxsKS5qb2luKCdcbicpLFsKCQkJJ1NlcmlmJywKCQkJJ1NhbnMgU2VyaWYnLAoJCQknTW9ub3NwYWNlJywKCQkJJ0Z1bGx3aWR0aCcsCgkJCSdTY3JpcHQnLAoJCQknRnJha3R1cicsCgkJCSdEb3VibGUgU3RydWNrJywKCQkJJ0VuY2xvc2VkJywKCQkJJ0ZsYWdjb2RlJywKCQkJJ1dpbmdkaW5ncycsCgkJXS5maWx0ZXIoaXRlbT0+aXRlbSE9PW51bGwpLGZhbHNlKTsKCQlpZiAoIWZhbWlseSkgcmV0dXJuOwoJCWlmIChbJ21vbm9zcGFjZScsJ2Z1bGx3aWR0aCcsJ2ZsYWdjb2RlJywnd2luZ2RpbmdzJ10uaW5jbHVkZXMoZmFtaWx5KSl7Zm9udD1mb250c1tmYW1pbHldO2JyZWFrIGZhbWlseVBpY2tlcn07CgkJaWYgKGZhbWlseT09PSdkb3VibGUgc3RydWNrJyl7Zm9udD1mb250cy5kb3VibGVTdHJ1Y2s7YnJlYWsgZmFtaWx5UGlja2VyfTsKCQlsZXQgc3R5bGU7CgkJaWYgKGZhbWlseT09PSdzYW5zIHNlcmlmJykgZmFtaWx5PSdzYW5zU2VyaWYnOwoJCWlmIChbJ3NlcmlmJywnc2Fuc1NlcmlmJ10uaW5jbHVkZXMoZmFtaWx5KSl7CgkJCXN0eWxlID0gY2hvb3NlKFsKCQkJCWBDaG9vc2UgYSBzdHlsZTpgLAoJCQkJYChDYW5jZWwgdG8gY2hhbmdlIGZvbnRzKWAsCgkJCQlgJHtidWxsZXR9ICR7Y29udmVydCgnTm9ybWFsJyxmb250c1tmYW1pbHldLm5vcm1hbCl9YCwKCQkJCWAke2J1bGxldH0gJHtjb252ZXJ0KCdCb2xkJyxmb250c1tmYW1pbHldLmJvbGQpfWAsCgkJCQlgJHtidWxsZXR9ICR7Y29udmVydCgnSXRhbGljJyxmb250c1tmYW1pbHldLml0YWxpYyl9YCwKCQkJCWAke2J1bGxldH0gJHtjb252ZXJ0KCdCb2xkIEl0YWxpYycsZm9udHNbZmFtaWx5XS5ib2xkSXRhbGljKX1gLAoJCQldLmZpbHRlcihpdGVtPT5pdGVtIT09bnVsbCkuam9pbignXG4nKSxbCgkJCQknTm9ybWFsJywKCQkJCSdCb2xkJywKCQkJCSdJdGFsaWMnLAoJCQkJJ0JvbGQgSXRhbGljJywKCQkJXS5maWx0ZXIoaXRlbT0+aXRlbSE9PW51bGwpLGZhbHNlKTsKCQl9OwoJCWlmIChbJ3NjcmlwdCcsJ2ZyYWt0dXInXS5pbmNsdWRlcyhmYW1pbHkpKXsKCQkJc3R5bGUgPSBjaG9vc2UoWwoJCQkJYENob29zZSBhIHN0eWxlOmAsCgkJCQlgKENhbmNlbCB0byBjaGFuZ2UgZm9udHMpYCwKCQkJCWAke2J1bGxldH0gJHtjb252ZXJ0KCdOb3JtYWwnLGZvbnRzW2ZhbWlseV0ubm9ybWFsKX0gKE5vcm1hbClgLAoJCQkJYCR7YnVsbGV0fSAke2NvbnZlcnQoJ0JvbGQnLGZvbnRzW2ZhbWlseV0uYm9sZCl9IChCb2xkKWAsCgkJCV0uZmlsdGVyKGl0ZW09Pml0ZW0hPT1udWxsKS5qb2luKCdcbicpLFsKCQkJCSdOb3JtYWwnLAoJCQkJJ0JvbGQnLAoJCQldLmZpbHRlcihpdGVtPT5pdGVtIT09bnVsbCksZmFsc2UpOwoJCX07CgkJaWYgKGZhbWlseT09PSdlbmNsb3NlZCcpewoJCQlzdHlsZSA9IGNob29zZShbCgkJCQlgQ2hvb3NlIGEgc3R5bGU6YCwKCQkJCWAoQ2FuY2VsIHRvIGNoYW5nZSBmb250cylgLAoJCQkJYCR7YnVsbGV0fSAke2NvbnZlcnQoJ0NpcmNsZScsZm9udHNbZmFtaWx5XS5jaXJjbGUpfWAsCgkJCQlgJHtidWxsZXR9ICR7Y29udmVydCgnQ2lyY2xlIEFsbCcsZm9udHNbZmFtaWx5XS5jaXJjbGVBbGwpfWAsCgkJCQlgJHtidWxsZXR9ICR7Y29udmVydCgnQ2lyY2xlIEZpbGwnLGZvbnRzW2ZhbWlseV0uY2lyY2xlRmlsbCl9YCwKCQkJCWAke2J1bGxldH0gJHtjb252ZXJ0KCdTcXVhcmUnLGZvbnRzW2ZhbWlseV0uc3F1YXJlKX1gLAoJCQkJYCR7YnVsbGV0fSAke2NvbnZlcnQoJ1NxdWFyZSBBbGwnLGZvbnRzW2ZhbWlseV0uc3F1YXJlQWxsKX0gKFNxdWFyZSBBbGwpYCwKCQkJCWAke2J1bGxldH0gJHtjb252ZXJ0KCdTcXVhcmUgRmlsbCcsZm9udHNbZmFtaWx5XS5zcXVhcmVGaWxsKX1gLAoJCQkJYCR7YnVsbGV0fSAke2NvbnZlcnQoJ0RpYW1vbmQnLGZvbnRzW2ZhbWlseV0uZGlhbW9uZCl9YCwKCQkJCWAke2J1bGxldH0gJHtjb252ZXJ0KCdEZW55Jyxmb250c1tmYW1pbHldLmRlbnkpfSAoRGVueSlgLAoJCQkJYCR7YnVsbGV0fSAke2NvbnZlcnQoJ1NjcmVlbicsZm9udHNbZmFtaWx5XS5zY3JlZW4pfSAoU2NyZWVuKWAsCgkJCQlgJHtidWxsZXR9ICR7Y29udmVydCgnS2V5Y2FwJyxmb250c1tmYW1pbHldLmtleWNhcCl9IChLZXljYXApYCwKCQkJCWAke2J1bGxldH0gJHtjb252ZXJ0KCdUcmlhbmdsZScsZm9udHNbZmFtaWx5XS50cmlhbmdsZSl9YCwKCQkJXS5qb2luKCdcbicpLFsKCQkJCSdDaXJjbGUnLAoJCQkJJ0NpcmNsZSBBbGwnLAoJCQkJJ0NpcmNsZSBGaWxsJywKCQkJCSdTcXVhcmUnLAoJCQkJJ1NxdWFyZSBBbGwnLAoJCQkJJ1NxdWFyZSBGaWxsJywKCQkJCSdEaWFtb25kJywKCQkJCSdEZW55JywKCQkJCSdTY3JlZW4nLAoJCQkJJ0tleWNhcCcsCgkJCQknVHJpYW5nbGUnCgkJCV0sZmFsc2UpOwoJCX07CgkJaWYgKHN0eWxlPT09J2JvbGQgaXRhbGljJylzdHlsZT0nYm9sZEl0YWxpYyc7CgkJaWYgKHN0eWxlPT09J2NpcmNsZSBhbGwnKXN0eWxlPSdjaXJjbGVBbGwnOwoJCWlmIChzdHlsZT09PSdjaXJjbGUgZmlsbCcpc3R5bGU9J2NpcmNsZUZpbGwnOwoJCWlmIChzdHlsZT09PSdzcXVhcmUgYWxsJylzdHlsZT0nc3F1YXJlQWxsJzsKCQlpZiAoc3R5bGU9PT0nc3F1YXJlIGZpbGwnKXN0eWxlPSdzcXVhcmVGaWxsJzsKCQlpZiAoc3R5bGUpe2ZvbnQ9Zm9udHNbZmFtaWx5XVtzdHlsZV07YnJlYWsgZmFtaWx5UGlja2VyfTsKCX07CglpZiAoZm9udD09PWZvbnRzLmZsYWdjb2RlKXsKCQlsZXQgc3BsaXQgPSBjb25maXJtKCdTcGxpdCBmbGFncyB3aXRoIHplcm8gd2lkdGggc3BhY2VzPycpOwoJCWlmICghc3BsaXQpIHJldHVybiBjb252ZXJ0KHN0cmluZyxmb250KTsKCQlmb250PWZvbnQubWFwKGNoYXI9PnsKCQkJaWYgKGNoYXIuY29kZVBvaW50QXQoMCk8PTB4N0YpIHJldHVybiBjaGFyOwoJCQlyZXR1cm4gY2hhcitaV1NQOwoJCX0pOwoJCWxldCBvdXQgPSBjb252ZXJ0KHN0cmluZyxmb250KTsKCQlvdXQ9b3V0LnJlcGxhY2VBbGwoLyg/PD1bXHV7MUYxRTZ9LVx1ezFGMUZGfV0pW1x1ezIwMEJ9XSg/IVtcdXsxRjFFNn0tXHV7MUYxRkZ9XSkvZ211LCcnKTsKCQlyZXR1cm4gb3V0OwoJfSBlbHNlIHtyZXR1cm4gY29udmVydChzdHJpbmcsZm9udCl9Owp9Ow==')};
			let pos = [target.selectionStart,target.selectionEnd];
			let before = target.value.slice(0,pos[0]);
			let after = target.value.slice(pos[1]);
			let selection = target.value.slice(...pos);
			selection = stylize(selection);
			if (!selection) return;
			textarea.value = before+selection+after;
			textarea.setSelectionRange(pos[0],pos[0]+selection.length);
		};
		function tag(string){
			for (let codePoint=0x20;codePoint<=0x7E;codePoint++){
				string=string.replaceAll(String.fromCodePoint(codePoint),String.fromCodePoint(0xE0000+codePoint))
			};
			return string;
		};
		function untag(string){
			for (let codePoint=0x20;codePoint<=0x7E;codePoint++){
				string=string.replaceAll(String.fromCodePoint(0xE0000+codePoint),String.fromCodePoint(codePoint))
			};
			return string;
		};
		if ([0b0010,0b0011].includes(modifiers) && code==='KeyX'){event.preventDefault();
			let before = target.value.slice(0,target.selectionStart);
			let after = target.value.slice(target.selectionEnd);
			let selection = target.value.slice(target.selectionStart,target.selectionEnd);
			if (modifiers===0b0010){selection=tag(selection)};
			if (modifiers===0b0011){selection=untag(selection)};
			target.value = before+selection+after;
			target.setSelectionRange(before.length,before.length);
		};
	}catch(e){alert(e?.stack??e)}};
</script>
<style>
	textarea {
		position: fixed;
		display: inline-block;
		top: 0;
		left: 0;
		width: 100vw;
		height: 100vh;
		tab-size: 4;
		resize: none;
		white-space: nowrap;
		overflow: scroll:
		outline: none;
		border: none;
		color-scheme: light;
	}
	@media(prefers-color-scheme:light){textarea{color-scheme:light;}}
	@media(prefers-color-scheme:dark){textarea{color-scheme:dark;}}
	textarea:focus {outline:none;}
</style>
<textarea id="textarea" spellcheck="false" onkeydown="input(event)"></textarea>
